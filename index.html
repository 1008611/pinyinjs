<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8"/>
	<title>汉字拼音互转示例</title>
	<style type="text/css">
	body{font-family: 'Microsoft Yahei'; font-size: 16px;}

.simple-input-method {
    position: absolute;
    background: #FFF;
    border: solid 1px #B5C5D2;
    font-family: 'Arial';
    color: #0364CD;
    display: none;
}
.simple-input-method .pinyin {
    border-bottom: solid 1px #B5C5D2;
    padding: 4px 10px;
    font-weight: bold;
}
.simple-input-method .result {
    padding: 4px 10px 4px 0px;
}
.simple-input-method .result ol {
    margin: 0;
    padding: 0;
    display: inline-block;
    vertical-align: middle;
}
.simple-input-method .result ol:after {
    content: '';
    display: block;
    clear: left;
}
.simple-input-method .result ol li {
    float: left;
    margin-left: 30px;
}
.simple-input-method .result ol li:first-child {
    color: red;
}
	</style>
</head>

<body>
	<h2>汉字转拼音：</h2>
	<div>
		<span>输出类型：</span>
		<label><input type="radio" name="pinyin_type" value="0" checked/>带声调拼音</label>
		<label><input type="radio" name="pinyin_type" value="1"/>不带声调拼音</label>
		<label><input type="radio" name="pinyin_type" value="2"/>拼音首字母</label>
	</div>
	<div>
		<label><input type="checkbox" name="polyphone"/>是否支持多音字</label>
		<span>支持多音字仅仅是将所有可能的组合列举出来，要做到准确识别多音字还需非常完善的词库。</span>
	</div>
	<input type="text" id="test" value="大中国">
	<h3>结果：</h3>
	<div id="result"></div>
	<h2>简单的拼音输入法(只支持单个汉字输入)：</h2>
	<input type="text" id="test_input">
	<div id="simle_input_method" class="simple-input-method">
		<div class="pinyin">kan'fa</div>
		<div class="result">
			<ol>
				<li>看</li><li>方法</li><li>个</li><li>是</li><li>和</li>
			</ol>
			<span class="page-up">&lt;</span><span class="page-down">&gt;</span>
		</div>
	</div>
	<!--<script type="text/javascript" src="pinyin_dict_firstletter.js"></script>
	<script type="text/javascript" src="old/pinyin_dict_all_new.js"></script>-->
	<script type="text/javascript" src="pinyin_dict_notone.js"></script>
	<script type="text/javascript" src="pinyin_dict_withtone.js"></script>
	<script type="text/javascript" src="pinyinUtil.js"></script>

	<script type="text/javascript">
	function getPinyin()
	{
		var value = document.getElementById('test').value;
		var type = document.querySelector('[name="pinyin_type"]:checked').value;
		var polyphone = document.querySelector('[name="polyphone"]').checked;
		var result = '';
		if(value)
		{
			switch(type)
			{
				case '0': result = pinyinUtil.getPinyin(value, ' ', true, polyphone); break;
				case '1': result = pinyinUtil.getPinyin(value, ' ', false, polyphone); break;
				case '2': result = pinyinUtil.getFirstLetter(value, polyphone); break;
				default: break;
			}
		}
		result = (result instanceof Array) ? result.join('<br>') : result;
		document.getElementById('result').innerHTML = result;
	}
	document.getElementById('test').addEventListener('input', getPinyin);
	document.getElementsByName('polyphone')[0].addEventListener('change', function(e)
	{
		getPinyin();
	});
	document.addEventListener('change', function(e)
	{
		if(e.target.name === 'pinyin_type')
		{
			getPinyin();
		}
	});
	getPinyin();


	// 简单的JS版输入法
	var SimpleInputMethod = 
	{
		hanzi: '',
		pinyin: '',
		result: [],
		pageCurrent: 1,
		pageSize: 5,
		pageCount: 0,
		init: function(obj)
		{
			this.obj = obj;
			this._target = document.querySelector('#simle_input_method');
			this._pinyinTarget = document.querySelector('#simle_input_method .pinyin');
			this._resultTarget = document.querySelector('#simle_input_method .result ol');
			var that = this;
			obj.addEventListener('keydown', function(e)
			{
				console.log(e.keyCode);
				var keyCode = e.keyCode;
				if(keyCode >= 65 && keyCode <= 90) that.addChar(String.fromCharCode(keyCode+32));
				else if(keyCode == 8) that.delChar();
				else if(keyCode >= 48 && keyCode <= 57) that.selectHanzi(keyCode-48);
				else if(keyCode == 32) that.selectHanzi(1);
				e.preventDefault();
			});
		},
		/**
		 * 拼音转汉字
		 */
		getHanzi: function(pinyin)
		{

			pinyin = pinyin.replace(/'/g, '');
			var result = pinyinUtil.getHanzi(pinyin);
			if(result) return [result.split(''), pinyin];
			var temp = '';
			for(var i=0, len = pinyin.length; i<len; i++)
			{
				temp += pinyin[i];
				result = pinyinUtil.getHanzi(temp);
				if(result && ((i+1)>=len) || !pinyinUtil.getHanzi(temp+pinyin[i+1]))
				{
					return [result.split(''), pinyin.substr(0, i+1) + "'" + pinyin.substr(i+1)];
				}
			}
			return [[], '']; // 理论上一般不会出现这种情况
		},
		selectHanzi: function(i)
		{
			this.hanzi += this.result[(this.pageCurrent-1)*this.pageSize+i-1];
			var idx = this.pinyin.indexOf("'");
			if(idx > 0)
			{
				this.pinyin = this.pinyin.substr(idx+1);
				this.refresh();
			}
			else
			{
				this.obj.value += this.hanzi;
				this.clear();
			}
		},
		refresh: function()
		{
			var temp = this.getHanzi(this.pinyin);
			console.log(temp)
			this.result = temp[0];
			this.pinyin = temp[1];
			var count = this.result.length;
			this.pageCurrent = 1;
			this.pageCount = Math.ceil(count / this.pageSize);
			var temp2 = this.result.slice((this.pageCurrent-1)*this.pageSize, this.pageCurrent*this.pageSize);
			var html = '';
			temp2.forEach(function(i)
			{
				html += '<li>' + i + '</li>';
			});
			this._resultTarget.innerHTML = html;
			this._pinyinTarget.innerHTML = this.hanzi + this.pinyin;
		},
		addChar: function(ch)
		{
			this.pinyin += ch;
			if(this.pinyin.length == 1) // 长度为1，显示输入法
			{
				this._target.style.display = 'block';
			}
			this.refresh();
		},
		delChar: function()
		{
			if(this.pinyin.length <= 1)
			{
				this.clear();
				return;
			}
			this.pinyin = this.pinyin.substr(0, this.pinyin.length-1);
			this.refresh();
		},
		clear: function()
		{
			this.hanzi = '';
			this.pinyin = '';
			this._pinyinTarget.innerHTML = '';
			this._target.style.display = 'none';
		}
	};
	SimpleInputMethod.init(document.getElementById('test_input'));

	</script>

</body>
</html>
